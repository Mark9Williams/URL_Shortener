{% extends "url_shortener/base.html" %}

{% block title %}My Links - Analytics{% endblock %}

{% block content %}
<div class="container">
    <!-- <h2 class="mb-4">Link Analytics (Top 20)</h2> -->
    <h2 class="mb4"> <a href="{% url 'link_analytics' %}">Link Analytics (Top 20)</a></h2>

    <!-- ðŸ” Search Form -->
    <form method="get" action="{% url 'link_analytics' %}" class="mb-4 d-flex">
        <input type="text" name="q" class="form-control me-2" placeholder="Search by short code or custom code" value="{{ request.GET.q }}">
        <button type="submit" class="btn btn-primary">Search</button>
    </form>

    <table class="table table-striped table-hover">
        <thead class="table-dark">
            <tr>
                <th>Original URL</th>
                <th>Short Code</th>
                <th>Custom Code</th>
                <th>Clicks</th>
            </tr>
        </thead>
        <tbody>
            {% for link in urls %}
            <tr>
                <td><a href="{{ link.original_url }}" target="_blank">{{ link.original_url|truncatechars:50 }}</a></td>
                <td>{{ link.short_code }}</td>
                <td>{% if link.custom_code %}{{ link.custom_code }}{% else %}-{% endif %}</td>
                <td>{{ link.click_count }}</td>
                <td>
  <!-- Copy Link -->
  <a href="{{ request.build_absolute_uri }}{{ link.short_code }}" 
     class="btn btn-sm btn-outline-secondary"
     onclick="navigator.clipboard.writeText(this.href); alert('Copied!'); return false;">
     Copy
  </a>

  <!-- Share on Twitter -->
  <a href="https://twitter.com/intent/tweet?url={{ request.build_absolute_uri }}{{ link.short_code }}&text=Check+out+this+link!"
     target="_blank" class="btn btn-sm btn-outline-primary">
     Twitter
  </a>

  <!-- Share on Facebook -->
  <a href="https://www.facebook.com/sharer/sharer.php?u={{ request.build_absolute_uri }}{{ link.short_code }}"
     target="_blank" class="btn btn-sm btn-outline-info">
     Facebook
  </a>

  <!-- Share via Email -->
  <a href="mailto:?subject=Check this link&body={{ request.build_absolute_uri }}{{ link.short_code }}"
     class="btn btn-sm btn-outline-success">
     Email
  </a>
</td>

            </tr>
            {% empty %}
            <tr>
                <td colspan="4" class="text-center">No links found.</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% endblock %}
